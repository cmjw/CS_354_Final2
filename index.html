<!DOCTYPE html>

<html>
    <style>
        .column {
            float: left;
            width: 50%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>

    <body>
        <script src="./lib/lightgl/lightgl.js"></script>
        <script src="./CSGBuilder.js"></script>
        <script src="./CSGViewer.js"></script>
        <script src="./geometry/CSG_B_Vector.js"></script>
        <script src="./geometry/CSG_B_Plane.js"></script>
        <script src="./geometry/CSG_B_Polygon.js"></script>
        <script src="./geometry/CSG_B_Vertex.js"></script>
        <script src="./geometry/CSG_B_Node.js"></script>

        <script src="./primitives/sphere.js"></script>
        <script src="./primitives/cube.js"></script>

        
        <div class="row">
            <div class="column">
                <div class="row">
                    <div class="column">
                        <h1>Primitive A</h1>
                        <td><div id="0" class="viewer"></div><code></code></td>
    
                        <select id="primitiveASelector" onchange="changePrimitiveA()">
                            <option value="cube">Cube</option>
                            <option value="sphere">Sphere</option>
                            <option value="memory">Memory</option>
                        </select>
                    </div>
                    <div class="column">
                        <h1>Primitive B</h1>
                        <td><div id="1" class="viewer"></div><code></code></td>
    
                        <select id="primitiveBSelector" onchange="changePrimitiveB()">
                            <option value="cube">Cube</option>
                            <option value="sphere">Sphere</option>
                            <option value="memory">Memory</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="column">
                        <h1>Operation</h1>
                        <select id="operationSelector" onchange="changeOperation()">
                            <option value="union">Union</option>
                            <option value="intersection">Intersection</option>
                            <option value="subtract">Subtract</option>
                        </select>
                        
                    </div>
                    <div class="column">
                        <h1>Save Result</h1>
                        <button onclick="saveToMemory()">Save to Memory</button>
                    </div>
                </div>
            </div>
            <div class="column">
                
                <td><div id="2" class="viewer"></div><code></code></td>
            </div>
            
          </div> 


        <script>

            var a = CSGBuilder.cube();
            var b = CSGBuilder.sphere({ radius: 1.35 });

            var r = Math.random()*2;
            var g = Math.random()*2;
            var bl = Math.random()*2;
            a.setColor(r,g,bl);

            r = Math.random()*2;
            g = Math.random()*2;
            bl = Math.random()*2;
            b.setColor(r,g,bl);

            var c = a.union(b);
            var memory = c;

            function saveToMemory() {
                memory = c.clone();
                updateViewers();
            }

            function changeOperation() {
                var select = document.getElementById("operationSelector");
                var selectedValue = select.options[select.selectedIndex].value;

                if (selectedValue === "union") {
                    c = a.union(b);
                } else if (selectedValue === "intersect") {
                    c = a.intersect(b);
                } else {
                    c = a.subtract(b);
                }
                updateViewers();
            }

            function changePrimitiveA() {
                console.log("change primitive A");

                var select = document.getElementById("primitiveASelector");
                var selectedValue = select.options[select.selectedIndex].value;
                
                // Modify var a based on selected primitive
                if (selectedValue === "cube") {
                    a = CSGBuilder.cube();
                } else if (selectedValue === "sphere") {
                    a = CSGBuilder.sphere({ radius: 1.35 });
                } else if (selectedValue == "memory") {
                    a = memory.clone();
                }

                var r = Math.random()*2;
                var g = Math.random()*2;
                var b = Math.random()*2;
                a.setColor(r,g,b);

                changeOperation();
                
                // Update viewer
                updateViewers();
            }

            function changePrimitiveB() {
                console.log("change primitive B");

                var select = document.getElementById("primitiveBSelector");
                var selectedValue = select.options[select.selectedIndex].value;
                
                // Modify var a based on selected primitive
                if (selectedValue === "cube") {
                    b = CSGBuilder.cube();
                } else if (selectedValue === "sphere") {
                    b = CSGBuilder.sphere({ radius: 1.35 });
                }

                var r = Math.random()*2;
                var g = Math.random()*2;
                var b = Math.random()*2;
                b.setColor(r,g,b);

                changeOperation();
                
                // Update viewer
                updateViewers();
            }


            function updateViewers() {
                // Clear existing viewers
                clearViewers();
                

                addViewer(new CSGViewer(a, 400, 400, 6));
                addViewer(new CSGViewer(b, 400, 400, 6));
                addViewer(new CSGViewer(c, 800, 800, 6));
            }
            

            updateViewers();
        </script>
    </body>
</html>